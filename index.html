<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>TuniLang - Vocabulaire et Dialogues Tunisiens</title>
  <style>
    body { 
      font-family: Arial, sans-serif; 
      max-width: 800px; 
      margin: 0 auto; 
      padding: 20px; 
      background: #fff8f0; 
      color: #333;
    }
    h1 { 
      color: #d35400; 
      text-align: center; 
      margin-bottom: 20px; 
    }
    section { 
      margin-bottom: 30px; 
      background: white;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }
    .word-card, .dialog-card {
      background: #f7e6d0;
      padding: 15px; 
      border-radius: 10px;
      margin-bottom: 15px;
    }
    .btn {
      background: #d35400; 
      color: white;
      border: none; 
      padding: 10px 15px;
      border-radius: 5px; 
      cursor: pointer;
      margin: 5px;
      font-weight: bold;
      transition: all 0.3s;
    }
    .btn:hover {
      background: #e67e22;
      transform: translateY(-2px);
    }
    .btn:disabled {
      background: #ccc;
      cursor: not-allowed;
    }
    .translation {
      font-style: italic;
      color: #6d4c41;
      margin: 10px 0;
    }
    .context {
      font-weight: bold;
      color: #a04000;
      margin-bottom: 10px;
    }
    hr {
      border: 0;
      height: 1px;
      background: #ddd;
      margin: 20px 0;
    }
    #imagePreview {
      max-width: 100%;
      height: auto;
      border-radius: 5px;
      margin-top: 10px;
    }
    .camera-container {
      position: relative;
      margin: 15px 0;
    }
    #cameraPreview {
      width: 100%;
      max-width: 500px;
      background: #000;
      border-radius: 5px;
    }
    #captureBtn {
      position: absolute;
      bottom: 10px;
      left: 50%;
      transform: translateX(-50%);
    }
    .detection-section {
      display: flex;
      flex-wrap: wrap;
      gap: 20px;
    }
    .detection-option {
      flex: 1;
      min-width: 300px;
    }
    .result-item {
      margin: 10px 0;
      padding: 10px;
      background: #f0f0f0;
      border-radius: 5px;
    }
    .error-message {
      color: #c0392b;
      font-weight: bold;
      padding: 10px;
      background: #fdecea;
      border-radius: 5px;
    }
    .success-message {
      color: #27ae60;
    }
    #chat {
      background: #f7e6d0;
      padding: 15px;
      border-radius: 10px;
    }
    .chat-message {
      margin: 10px 0;
      padding: 8px 12px;
      border-radius: 5px;
    }
    .user-message {
      background: #e6f7ff;
      margin-left: 20%;
      text-align: right;
    }
    .bot-message {
      background: #fff;
      margin-right: 20%;
    }
    #suggestion-form {
      display: none;
      margin-top: 15px;
      padding: 15px;
      background: #f0f0f0;
      border-radius: 5px;
    }
    #loadingIndicator {
      display: none;
      text-align: center;
      margin: 10px 0;
    }
  </style>
</head>
<body>

<h1>TuniLang - Apprentissage du Tunisien</h1>

<!-- Section Vocabulaire -->
<section id="words-section">
  <h2>Vocabulaire Tunisien</h2>
  <div class="word-card">
    <div id="word-text" style="font-size: 1.8em; font-weight: bold; color: #d35400;"></div>
    <div id="word-category" style="font-size: 0.9em; color: #7f8c8d;"></div>
    <div class="translation" id="word-translation"></div>
    <button class="btn" onclick="playWordAudio()">üîä √âcouter</button>
  </div>
  <div style="text-align: center;">
    <button class="btn" onclick="prevWord()">‚¨Ö Pr√©c√©dent</button>
    <button class="btn" onclick="nextWord()">Suivant ‚û°</button>
  </div>
</section>

<hr />

<!-- Section Dialogues -->
<section id="dialogs-section">
  <h2>Dialogues Pratiques</h2>
  <div class="dialog-card">
    <div class="context" id="dialog-context"></div>
    <div id="dialog-text" style="line-height: 1.6;"></div>
  </div>
  <div style="text-align: center;">
    <button class="btn" onclick="prevDialog()">‚¨Ö Pr√©c√©dent</button>
    <button class="btn" onclick="nextDialog()">Suivant ‚û°</button>
  </div>
</section>

<hr />

<!-- Section Reconnaissance d'Objets -->
<section>
  <h2>Reconnaissance d'Objets</h2>
  <p>Prenez une photo ou uploadez une image pour conna√Ætre la traduction en tunisien</p>
  
  <div class="detection-section">
    <div class="detection-option">
      <h3>Upload d'image</h3>
      <input type="file" id="imageUpload" accept="image/*" />
      <div id="imagePreviewContainer" style="margin-top:10px;"></div>
    </div>
    
    <div class="detection-option">
      <h3>Utiliser la cam√©ra</h3>
      <div class="camera-container">
        <video id="cameraPreview" autoplay playsinline></video>
        <button class="btn" id="captureBtn">Prendre une photo</button>
      </div>
      <canvas id="canvas" style="display:none;"></canvas>
    </div>
  </div>
  
  <div id="loadingIndicator">
    <p>Analyse en cours...</p>
  </div>
  
  <div id="result" style="margin-top: 20px;"></div>

  <div id="suggestion-form">
    <h3>Proposer une traduction</h3>
    <p>Objet: <strong id="detected-word"></strong></p>
    <input type="text" id="suggestion-input" placeholder="Traduction tunisienne" style="padding: 8px; width: 70%; margin-right: 10px;">
    <button class="btn" onclick="submitSuggestion()">Envoyer</button>
  </div>
</section>

<hr />

<!-- Section Conversation Interactive -->
<section>
  <h2>Conversation Interactive</h2>
  <div id="chat">
    <p class="chat-message bot-message">Bienvenue au restaurant tunisien. Que souhaitez-vous commander ?</p>
    <div style="text-align: center;">
      <button class="btn" onclick="userReply('couscous')">Couscous</button>
      <button class="btn" onclick="userReply('pizza')">Pizza</button>
    </div>
  </div>
</section>

<!-- Biblioth√®ques externes -->
<script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@3.18.0/dist/tf.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/mobilenet@2.1.0"></script>

<script>
  // ============ DONN√âES ORIGINALES CONSERV√âES ============
  const data = {
    words: [
      // Salutations
      {word: "Aslema", translation: "Bonjour", category: "Salutations"},
      {word: "Bislam", translation: "Au revoir", category: "Salutations"},
      {word: "Sabah el khir", translation: "Bonjour (matin)", category: "Salutations"},
      {word: "Massa el khir", translation: "Bonsoir", category: "Salutations"},
      {word: "Ahlan", translation: "Salut/Bienvenue", category: "Salutations"},
      {word: "Marhaba", translation: "Bienvenue", category: "Salutations"},
      
      // Questions courantes
      {word: "Chnowa", translation: "Quoi ?", category: "Questions"},
      {word: "Kifach", translation: "Comment ?", category: "Questions"},
      {word: "Win", translation: "O√π ?", category: "Questions"},
      {word: "Wa9tech", translation: "Quand ?", category: "Questions"},
      {word: "Chkoun", translation: "Qui ?", category: "Questions"},
      {word: "3lech", translation: "Pourquoi ?", category: "Questions"},
      
      // Nourriture et boissons
      {word: "Mekla", translation: "Nourriture", category: "Nourriture"},
      {word: "Coussi", translation: "Couscous", category: "Nourriture"},
      {word: "Brik", translation: "Brick", category: "Nourriture"},
      {word: "Tajin", translation: "Tajine", category: "Nourriture"},
      {word: "Khobz", translation: "Pain", category: "Nourriture"},
      {word: "Lham", translation: "Viande", category: "Nourriture"},
      {word: "Djej", translation: "Poulet", category: "Nourriture"},
      {word: "Hout", translation: "Poisson", category: "Nourriture"},
      {word: "Chrib", translation: "Boisson", category: "Nourriture"},
      {word: "Ma", translation: "Eau", category: "Nourriture"},
      {word: "Leben", translation: "Lait", category: "Nourriture"},
      {word: "9ahwa", translation: "Caf√©", category: "Nourriture"},
      {word: "Th√©", translation: "Th√©", category: "Nourriture"},
      
      // Chiffres (1-10)
      {word: "Wa7ed", translation: "Un", category: "Chiffres"},
      {word: "Zouj", translation: "Deux", category: "Chiffres"},
      {word: "Thletha", translation: "Trois", category: "Chiffres"},
      {word: "Arba3a", translation: "Quatre", category: "Chiffres"},
      {word: "Khamsa", translation: "Cinq", category: "Chiffres"},
      {word: "Sitta", translation: "Six", category: "Chiffres"},
      {word: "Seb3a", translation: "Sept", category: "Chiffres"},
      {word: "Thmenia", translation: "Huit", category: "Chiffres"},
      {word: "Tes3a", translation: "Neuf", category: "Chiffres"},
      {word: "3achra", translation: "Dix", category: "Chiffres"},
      
      // Famille
      {word: "Famille", translation: "3a√Øla", category: "Famille"},
      {word: "P√®re", translation: "Baba", category: "Famille"},
      {word: "M√®re", translation: "Mama", category: "Famille"},
      {word: "Fr√®re", translation: "Khouya", category: "Famille"},
      {word: "Soeur", translation: "Okhti", category: "Famille"},
      {word: "Fils", translation: "Weld", category: "Famille"},
      {word: "Fille", translation: "Bent", category: "Famille"},
      {word: "Ami", translation: "Sahbi", category: "Famille"},
      {word: "Amie", translation: "Sahbiti", category: "Famille"},
      
      // Maison
      {word: "Maison", translation: "Dar", category: "Maison"},
      {word: "Porte", translation: "Bab", category: "Maison"},
      {word: "Fen√™tre", translation: "Chobek", category: "Maison"},
      {word: "Cuisine", translation: "Matbakh", category: "Maison"},
      {word: "Chambre", translation: "Bit", category: "Maison"},
      {word: "Salon", translation: "Salon", category: "Maison"},
      {word: "Toilette", translation: "Bit erraha", category: "Maison"},
      
      // Ville
      {word: "Ville", translation: "Medina", category: "Ville"},
      {word: "Rue", translation: "Zan9a", category: "Ville"},
      {word: "March√©", translation: "Souk", category: "Ville"},
      {word: "Magasin", translation: "Hanout", category: "Ville"},
      {word: "Restaurant", translation: "Resto", category: "Ville"},
      {word: "H√¥tel", translation: "Otel", category: "Ville"},
      {word: "Banque", translation: "Bank", category: "Ville"},
      {word: "Pharmacie", translation: "Pharmacy", category: "Ville"},
      {word: "H√¥pital", translation: "Sbitar", category: "Ville"},
      
      // Transports
      {word: "Voiture", translation: "Tomobile", category: "Transports"},
      {word: "Bus", translation: "Kar", category: "Transports"},
      {word: "Train", translation: "Tren", category: "Transports"},
      {word: "Avion", translation: "Tayara", category: "Transports"},
      {word: "Taxi", translation: "Taxi", category: "Transports"},
      {word: "V√©lo", translation: "Bisklet", category: "Transports"},
      
      // Temps
      {word: "Temps", translation: "Wa9t", category: "Temps"},
      {word: "Jour", translation: "Nhar", category: "Temps"},
      {word: "Nuit", translation: "Lil", category: "Temps"},
      {word: "Matin", translation: "Sbe7", category: "Temps"},
      {word: "Soir", translation: "3chiyya", category: "Temps"},
      {word: "Aujourd'hui", translation: "Lyom", category: "Temps"},
      {word: "Demain", translation: "Ghodwa", category: "Temps"},
      {word: "Hier", translation: "Ber7", category: "Temps"},
      
      // Couleurs
      {word: "Blanc", translation: "Byedh", category: "Couleurs"},
      {word: "Noir", translation: "K7el", category: "Couleurs"},
      {word: "Rouge", translation: "7mer", category: "Couleurs"},
      {word: "Vert", translation: "5odher", category: "Couleurs"},
      {word: "Bleu", translation: "Zra9", category: "Couleurs"},
      {word: "Jaune", translation: "Sfar", category: "Couleurs"},
      
      // Expressions utiles
      {word: "Merci", translation: "3aychek", category: "Expressions"},
      {word: "S'il te pla√Æt", translation: "Allah ikhalik", category: "Expressions"},
      {word: "Excusez-moi", translation: "Samahni", category: "Expressions"},
      {word: "D√©sol√©", translation: "Asif", category: "Expressions"},
      {word: "Pas de probl√®me", translation: "Mouch mouchkil", category: "Expressions"},
      {word: "Je ne comprends pas", translation: "Manfhemch", category: "Expressions"},
      {word: "Parlez lentement", translation: "7key bshwaya", category: "Expressions"},
      {word: "Combien √ßa co√ªte ?", translation: "9adech?", category: "Expressions"},
      {word: "C'est cher", translation: "Ghaly", category: "Expressions"},
      {word: "Bon app√©tit", translation: "Sa7tek", category: "Expressions"},
      {word: "Sant√©", translation: "Saha", category: "Expressions"},
      {word: "F√©licitations", translation: "Mabrouk", category: "Expressions"},
      {word: "Bonne chance", translation: "B3athelkom", category: "Expressions"},
      {word: "√Ä tes souhaits", translation: "Erham chabek", category: "Expressions"}
    ],

    // Dialogues enrichis (10 situations)
    dialogs: [
      {
        id: 1,
        context: "Rencontre et salutations",
        conversation: [
          {tunisian: "Aslema!", english: "Bonjour!"},
          {tunisian: "Ahlan bik!", english: "Bienvenue √† toi!"},
          {tunisian: "Chnowa ismek?", english: "Comment tu t'appelles?"},
          {tunisian: "Ismi Mohamed. W enti?", english: "Je m'appelle Mohamed. Et toi?"},
          {tunisian: "Ana Emma. Enchant√©e!", english: "Moi c'est Emma. Enchant√©e!"}
        ]
      },
      {
        id: 2,
        context: "Demander son chemin",
        conversation: [
          {tunisian: "Samahni, win souk el bled?", english: "Excusez-moi, o√π est le march√© central?"},
          {tunisian: "Aala chmel. 200 mitrou.", english: "√Ä gauche. √Ä 200 m√®tres."},
          {tunisian: "Bikam el taxi?", english: "Combien co√ªte le taxi?"},
          {tunisian: "Ta5 dima. Mouch barcha.", english: "5 dinars. Pas beaucoup."},
          {tunisian: "Yaishek!", english: "Merci!"}
        ]
      },
      {
        id: 3,
        context: "Au restaurant",
        conversation: [
          {tunisian: "Chnowa t7eb takoul?", english: "Que veux-tu manger?"},
          {tunisian: "B7eb couscous.", english: "Je veux du couscous."},
          {tunisian: "3la rassek! Djej wala lham?", english: "Avec plaisir! Poulet ou viande?"},
          {tunisian: "Djej, 3aychek.", english: "Poulet, s'il te pla√Æt."},
          {tunisian: "Sa7tek!", english: "Bon app√©tit!"}
        ]
      },
      {
        id: 4,
        context: "Achats au march√©",
        conversation: [
          {tunisian: "Bikam kilo etfah?", english: "Combien le kilo de pommes?"},
          {tunisian: "Khamsa dinar.", english: "5 dinars."},
          {tunisian: "Ghaly barcha! Arba3a?", english: "Trop cher! 4 dinars?"},
          {tunisian: "Yaishek, khod!", english: "D'accord, prends!"},
          {tunisian: "Allah ikhalik.", english: "Merci beaucoup."}
        ]
      },
      {
        id: 5,
        context: "Prendre un taxi",
        conversation: [
          {tunisian: "Sbe7 el khir. B7eb nemchi l aeroport.", english: "Bonjour. Je veux aller √† l'a√©roport."},
          {tunisian: "Ay 7aja. Bikam el wa9t?", english: "Pas de probl√®me. √Ä quelle heure?"},
          {tunisian: "3and sa3a. Bikam?", english: "Dans une heure. Combien?"},
          {tunisian: "3achrin dinar.", english: "20 dinars."},
          {tunisian: "Tayeb, yallah!", english: "D'accord, allons-y!"}
        ]
      },
      {
        id: 6,
        context: "√Ä l'h√¥tel",
        conversation: [
          {tunisian: "3andkom chambre lil leila?", english: "Avez-vous une chambre pour la nuit?"},
          {tunisian: "Ay 7aja. 3andna.", english: "Oui, bien s√ªr. Nous en avons."},
          {tunisian: "Bikam?", english: "Combien?"},
          {tunisian: "Settin dinar.", english: "60 dinars."},
          {tunisian: "Tayeb, nheb na3mel reservation.", english: "D'accord, je veux r√©server."}
        ]
      },
      {
        id: 7,
        context: "Visite m√©dicale",
        conversation: [
          {tunisian: "Chnowa l mochkil?", english: "Quel est le probl√®me?"},
          {tunisian: "3andi s5ouna w sa3b netnafes.", english: "J'ai de la fi√®vre et du mal √† respirer."},
          {tunisian: "T7eb tchouf tabib?", english: "Tu veux voir un m√©decin?"},
          {tunisian: "Ay, 3aychek.", english: "Oui, s'il te pla√Æt."},
          {tunisian: "Yallah, nrou7 l sbitar.", english: "Allons √† l'h√¥pital."}
        ]
      },
      {
        id: 8,
        context: "A la banque",
        conversation: [
          {tunisian: "Sbe7 el khir. Nheb nbadal flous.", english: "Bonjour. Je veux changer de l'argent."},
          {tunisian: "Ch7al?", english: "Combien?"},
          {tunisian: "Miyat uro. Bikam?", english: "100 euros. √Ä quel taux?"},
          {tunisian: "3.20 dinar lil uro.", english: "3.20 dinars pour 1 euro."},
          {tunisian: "Tayeb, khod.", english: "D'accord, prenez."}
        ]
      },
      {
        id: 9,
        context: "Achats de v√™tements",
        conversation: [
          {tunisian: "Nheb nchri kamizet.", english: "Je veux acheter une chemise."},
          {tunisian: "Chnowa l couleur t7eb?", english: "Quelle couleur tu veux?"},
          {tunisian: "Zra9. 3andkom?", english: "Bleue. Vous en avez?"},
          {tunisian: "Ay. Tjarbha.", english: "Oui. Essaie-la."},
          {tunisian: "Tayba barcha! Bikam?", english: "Tr√®s jolie! Combien?"}
        ]
      },
      {
        id: 10,
        context: "Demander l'heure",
        conversation: [
          {tunisian: "Samahni, bikam el sa3a?", english: "Excusez-moi, quelle heure est-il?"},
          {tunisian: "El sa3a thletha w nos.", english: "Il est 3h30."},
          {tunisian: "Wa9tech yetla3 el kar?", english: "Quand part le bus?"},
          {tunisian: "F sa3a arba3a.", english: "√Ä 4 heures."},
          {tunisian: "Yaishek!", english: "Merci!"}
        ]
      }
    ]
  };

  // Dictionnaire de traduction des objets (conserv√© et √©tendu)
  const dictionary = {
    'soccer ball': 'koora',
    'ball': 'koora',
    'tennis racket': 'raquette tennis',
    // ... (toutes vos entr√©es d'origine conserv√©es)
  };

  // ============ VARIABLES D'√âTAT ============
  let currentWordIndex = 0;
  let currentDialogIndex = 0;
  let net;
  let modelLoaded = false;

  // ============ INITIALISATION ============
  function initApp() {
    loadModel();
    initCamera();
    showCurrentWord();
    showCurrentDialog();
    setupEventListeners();
  }

  // ============ FONCTIONS VOCABULAIRE ============
  function showCurrentWord() {
    const word = data.words[currentWordIndex];
    document.getElementById('word-text').textContent = word.word;
    document.getElementById('word-translation').textContent = word.translation;
    document.getElementById('word-category').textContent = "Cat√©gorie: " + word.category;
  }

  function playWordAudio() {
    const word = data.words[currentWordIndex].word;
    const utterance = new SpeechSynthesisUtterance(word);
    utterance.lang = 'ar-TN';
    speechSynthesis.speak(utterance);
  }

  function prevWord() {
    if (currentWordIndex > 0) {
      currentWordIndex--;
      showCurrentWord();
    }
  }

  function nextWord() {
    if (currentWordIndex < data.words.length - 1) {
      currentWordIndex++;
      showCurrentWord();
    }
  }

  // ============ FONCTIONS DIALOGUES ============
  function showCurrentDialog() {
    const dialog = data.dialogs[currentDialogIndex];
    document.getElementById('dialog-context').textContent = dialog.context;
    
    let dialogHTML = dialog.conversation.map(line =>
      `<div style="margin-bottom: 10px;">
        <div style="font-weight:bold;">${line.tunisian}</div>
        <div style="font-style:italic;">${line.english}</div>
      </div>`
    ).join('');
    
    document.getElementById('dialog-text').innerHTML = dialogHTML;
  }

  function prevDialog() {
    if (currentDialogIndex > 0) {
      currentDialogIndex--;
      showCurrentDialog();
    }
  }

  function nextDialog() {
    if (currentDialogIndex < data.dialogs.length - 1) {
      currentDialogIndex++;
      showCurrentDialog();
    }
  }

  // ============ RECONNAISSANCE D'OBJETS ============
  async function loadModel() {
    try {
      document.getElementById('result').innerHTML = '<p>Chargement du mod√®le...</p>';
      net = await mobilenet.load();
      modelLoaded = true;
      document.getElementById('result').innerHTML = '<p class="success-message">Mod√®le pr√™t √† utiliser!</p>';
    } catch (error) {
      console.error("Erreur:", error);
      document.getElementById('result').innerHTML = `
        <p class="error-message">Erreur de chargement du mod√®le</p>
        <p>${error.message}</p>
      `;
    }
  }

  async function initCamera() {
    try {
      const stream = await navigator.mediaDevices.getUserMedia({ video: true });
      document.getElementById('cameraPreview').srcObject = stream;
    } catch (error) {
      console.error("Erreur cam√©ra:", error);
      document.getElementById('result').innerHTML = `
        <p class="error-message">Impossible d'acc√©der √† la cam√©ra</p>
        <p>${error.message}</p>
      `;
    }
  }

  function captureFromCamera() {
    const video = document.getElementById('cameraPreview');
    const canvas = document.getElementById('canvas');
    canvas.width = video.videoWidth;
    canvas.height = video.videoHeight;
    canvas.getContext('2d').drawImage(video, 0, 0);
    
    canvas.toBlob(async (blob) => {
      const img = new Image();
      img.src = URL.createObjectURL(blob);
      document.getElementById('imagePreviewContainer').innerHTML = '';
      document.getElementById('imagePreviewContainer').appendChild(img);
      await analyzeImage(img);
    }, 'image/jpeg');
  }

  function handleImageUpload(event) {
    const file = event.target.files[0];
    if (!file) return;

    if (!file.type.match('image.*')) {
      document.getElementById('result').innerHTML = '<p class="error-message">Fichier non support√©</p>';
      return;
    }

    const reader = new FileReader();
    reader.onload = async (e) => {
      const img = new Image();
      img.src = e.target.result;
      
      img.onload = async () => {
        document.getElementById('imagePreviewContainer').innerHTML = '';
        document.getElementById('imagePreviewContainer').appendChild(img);
        await analyzeImage(img);
      };
      
      img.onerror = () => {
        document.getElementById('result').innerHTML = '<p class="error-message">Image corrompue</p>';
      };
    };
    
    reader.readAsDataURL(file);
  }

  async function analyzeImage(img) {
    if (!modelLoaded) {
      document.getElementById('result').innerHTML = '<p class="error-message">Mod√®le non charg√©</p>';
      return;
    }

    document.getElementById('loadingIndicator').style.display = 'block';
    document.getElementById('result').innerHTML = '';

    try {
      const canvas = document.createElement('canvas');
      canvas.width = 224;
      canvas.height = 224;
      const ctx = canvas.getContext('2d');
      ctx.drawImage(img, 0, 0, 224, 224);
      
      const predictions = await net.classify(canvas);
      displayResults(predictions);
    } catch (error) {
      console.error("Erreur:", error);
      document.getElementById('result').innerHTML = `
        <p class="error-message">Erreur d'analyse</p>
        <p>${error.message}</p>
      `;
    } finally {
      document.getElementById('loadingIndicator').style.display = 'none';
    }
  }

  function displayResults(predictions) {
    let resultsHTML = '<h3>R√©sultats:</h3>';
    let found = false;
    
    predictions.slice(0, 3).forEach(pred => {
      const tunisian = dictionary[pred.className.toLowerCase()] || 'Inconnu';
      if (tunisian !== 'Inconnu') found = true;
      
      resultsHTML += `
        <div class="result-item">
          <p><strong>Objet:</strong> ${pred.className}</p>
          <p><strong>Tunisien:</strong> ${tunisian}</p>
          <p><strong>Pr√©cision:</strong> ${(pred.probability * 100).toFixed(1)}%</p>
        </div>
      `;
    });
    
    if (!found) {
      resultsHTML += `<p>Traduction manquante. <a href="#" onclick="showSuggestionForm('${predictions[0].className}')">Proposer une traduction</a></p>`;
    }
    
    document.getElementById('result').innerHTML = resultsHTML;
  }

  function showSuggestionForm(objectName) {
    document.getElementById('detected-word').textContent = objectName;
    document.getElementById('suggestion-form').style.display = 'block';
  }

  function submitSuggestion() {
    const object = document.getElementById('detected-word').textContent;
    const translation = document.getElementById('suggestion-input').value.trim();
    
    if (translation) {
      alert(`Merci! Suggestion enregistr√©e:\n${object} = ${translation}`);
      document.getElementById('suggestion-form').style.display = 'none';
      document.getElementById('suggestion-input').value = '';
    } else {
      alert("Veuillez entrer une traduction");
    }
  }

  // ============ CONVERSATION INTERACTIVE ============
  function userReply(choice) {
    const chat = document.getElementById('chat');
    
    // Ajouter r√©ponse utilisateur
    const userMsg = document.createElement('p');
    userMsg.className = 'chat-message user-message';
    userMsg.textContent = `Vous: ${choice}`;
    chat.appendChild(userMsg);
    
    // Supprimer anciens boutons
    chat.querySelectorAll('button').forEach(btn => btn.remove());
    
    // R√©ponse du bot
    const botMsg = document.createElement('p');
    botMsg.className = 'chat-message bot-message';
    
    if (choice === 'couscous') {
      botMsg.textContent = "Excellent choix! Viande ou poulet?";
      chat.appendChild(botMsg);
      
      const meatBtn = document.createElement('button');
      meatBtn.className = 'btn';
      meatBtn.textContent = 'Viande';
      meatBtn.onclick = () => endConversation('Couscous viande');
      
      const chickenBtn = document.createElement('button');
      chickenBtn.className = 'btn';
      chickenBtn.textContent = 'Poulet';
      chickenBtn.onclick = () => endConversation('Couscous poulet');
      
      chat.appendChild(meatBtn);
      chat.appendChild(chickenBtn);
    } 
    else if (choice === 'pizza') {
      botMsg.textContent = "Pizza! Avec olives?";
      chat.appendChild(botMsg);
      
      const yesBtn = document.createElement('button');
      yesBtn.className = 'btn';
      yesBtn.textContent = 'Oui';
      yesBtn.onclick = () => endConversation('Pizza olives');
      
      const noBtn = document.createElement('button');
      noBtn.className = 'btn';
      noBtn.textContent = 'Non';
      noBtn.onclick = () => endConversation('Pizza nature');
      
      chat.appendChild(yesBtn);
      chat.appendChild(noBtn);
    }
  }

  function endConversation(choice) {
    const chat = document.getElementById('chat');
    
    // Dernier message utilisateur
    const userMsg = document.createElement('p');
    userMsg.className = 'chat-message user-message';
    userMsg.textContent = `Vous: ${choice}`;
    chat.appendChild(userMsg);
    
    // Supprimer boutons
    chat.querySelectorAll('button').forEach(btn => btn.remove());
    
    // Message final
    const botMsg = document.createElement('p');
    botMsg.className = 'chat-message bot-message';
    botMsg.textContent = `Parfait! Votre ${choice} arrive bient√¥t.`;
    chat.appendChild(botMsg);
    
    // Bouton recommencer
    const restartBtn = document.createElement('button');
    restartBtn.className = 'btn';
    restartBtn.textContent = 'Recommencer';
    restartBtn.style.margin = '10px auto';
    restartBtn.style.display = 'block';
    restartBtn.onclick = resetChat;
    chat.appendChild(restartBtn);
  }

  function resetChat() {
    document.getElementById('chat').innerHTML = `
      <p class="chat-message bot-message">Bienvenue au restaurant tunisien. Que souhaitez-vous commander ?</p>
      <div style="text-align: center;">
        <button class="btn" onclick="userReply('couscous')">Couscous</button>
        <button class="btn" onclick="userReply('pizza')">Pizza</button>
      </div>
    `;
  }

  // ============ CONFIGURATION ============
  function setupEventListeners() {
    document.getElementById('imageUpload').addEventListener('change', handleImageUpload);
    document.getElementById('captureBtn').addEventListener('click', captureFromCamera);
  }

  // D√©marrer l'application
  window.addEventListener('DOMContentLoaded', initApp);
  // ============ DONN√âES ENRICHIES ============

  // Vocabulaire enrichi (120+ mots organis√©s par cat√©gories)
  
  // ============ FONCTIONS AFFICHAGE VOCABULAIRE PAR CATEGORIE ============
  function showCurrentWord() {
    const word = data.words[currentWordIndex];
    document.getElementById('word-text').textContent = word.word;
    document.getElementById('word-translation').textContent = word.translation;
    document.getElementById('word-category').textContent = word.category;
    
    // Afficher la cat√©gorie avec un style sp√©cial
    const categoryElement = document.getElementById('word-category');
    categoryElement.innerHTML = `<span class="category-title">${word.category}</span>`;
  }

  // [Le reste du code JavaScript pr√©c√©dent est conserv√© sans changement]
  
  // Initialisation
  window.addEventListener('DOMContentLoaded', initApp);
</script>

</body>
</html>